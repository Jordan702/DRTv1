<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mint Portal</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background-color: #f5f6fa; display: flex; flex-direction: column; align-items: center; padding: 40px; }
  h1 { display: flex; align-items: center; gap: 10px; }
  img.logo { height: 50px; }
  form, .batch-mint { margin-top: 20px; display: flex; flex-direction: column; gap: 15px; width: 300px; }
  input, button { padding: 8px; font-size: 16px; }
  button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
  button:hover { background-color: #45a049; }
  #status { margin-top: 20px; font-weight: bold; white-space: pre-line; }
</style>
</head>
<body>

<h1>
  <img src="../Logos/sETH Logo.png" alt="sETH Logo" class="logo">
  Mint Tokens
</h1>

<form id="mintForm">
  <label>Recipient Address:</label>
  <input type="text" id="recipient" placeholder="0x..." required>

  <label>Amount (like 11000000000000):</label>
  <input type="text" id="amount" placeholder="Amount" required>

  <button type="submit">Mint</button>
</form>

<div class="batch-mint">
  <h3>Batch Mint DRTv2 Tokens</h3>
  <input id="batchRecipient" type="text" placeholder="Recipient Address" />
  <input id="batchTimes" type="number" placeholder="Number of times (e.g. 200)" />
  <button onclick="doBatchMint()">Batch Mint</button>
</div>

<div id="status"></div>

<script>
// Single mint
document.getElementById("mintForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const recipient = document.getElementById("recipient").value.trim();
    const amountInput = document.getElementById("amount").value.trim();
    if (!recipient || !amountInput) { alert("Please fill in both fields!"); return; }

    try {
        const amount = BigInt(amountInput); // No longer need to multiply by 10^18 on the frontend
        document.getElementById("status").innerText = `⏳ Minting ${amountInput} tokens...`;

        const res = await axios.post("https://drtv1-backend.onrender.com/api/mint", {
            recipient,
            amount: amount.toString()
        });

        document.getElementById("status").innerText = `✅ Mint successful! TxHash: ${res.data.txHash}`;
    } catch (err) {
        console.error("[Frontend] Mint error:", err.response?.data || err.message);
        document.getElementById("status").innerText = `❌ Error: ${err.response?.data?.error || err.message}`;
    }
});

// Batch mint using the correct /api/batch-mint endpoint
async function doBatchMint() {
    const recipient = document.getElementById("batchRecipient").value.trim();
    const times = parseInt(document.getElementById("batchTimes").value);
    if (!recipient || !times || times <= 0) { alert("Please enter valid recipient and number of times!"); return; }

    document.getElementById("status").innerText = `⏳ Sending batch request to server for ${times} mints...`;

    try {
        // Correctly call the backend's batch-mint endpoint
        const res = await axios.post("https://drtv1-backend.onrender.com/api/batch-mint", {
            recipient,
            times
        });
        
        const txHashes = res.data.txHashes;

        document.getElementById("status").innerText = `✅ Batch mint complete!\n${times} x 99 tokens minted.\nFirst 5 TxHashes:\n${txHashes.slice(0,5).join("\n")}\n...and ${txHashes.length - 5} more.`;
    } catch (err) {
        console.error("[Frontend] Batch mint error:", err.response?.data || err.message);
        document.getElementById("status").innerText = `❌ Batch mint failed: ${err.response?.data?.error || err.message}`;
    }
}
</script>

</body>
</html>
